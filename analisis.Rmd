---
title: "ANÀLISI"
author: "Irene Soler Quevedo"
output: pdf_document
---

PAQUETS UTILITZATS

```{r}
library(readxl)#llegir excel

library(tidyverse);library(dplyr)#tractament dades

#alpha crobatch
install.packages("psych")  
library(psych)
```

# LLEGIR DADES:

```{r}
bbdd_cat <- read_excel("bbdd_cat.xlsx", 
    sheet = "Datos sin procesar", col_names = FALSE)
bbdd_caste <- read_excel("bbdd_caste.xlsx", 
    sheet = "Datos sin procesar", col_names = FALSE)

colnames(bbdd_caste)<- bbdd_caste[1,]
bbdd_caste <- bbdd_caste[-1,-c(2:18, 95:101)]#eliminem la primera fila que eren els noms de les columnes
#també hem eliminat columnes que no interessen, que són propiament de l'aplicació
colnames(bbdd_cat)<- bbdd_cat[1,]
bbdd_cat <- bbdd_cat[-1,-c(2:18, 95:101)]

bbdd_caste

colnames(bbdd_caste) <- colnames(bbdd_cat) <- c("ID", "Politica_Privacitat", "Empresa", "Propietari?", "Directiu?",
                          "Genere_directiu", "Genere_directiu_altres", "Any_naixement_directiu","Any_acces_carrec_directiu", "Manera_acces_carrec_directiu", "Manera_acces_carrec_directiu_altres", 
                          "N_propietaris_directiu", "Genere_propietaris_directiu","Genere_propietari_directiu", 
                          "Genere_1prop", "Any_naixement_1prop", "Any_acces_propietat_1prop", "Manera_acces_1prop", "Manera_acces_1prop_altres", "N_propietaris_+1prop", "Genere_propietaris_+1prop", "Genere_+1prop", "Any_naixement_+1prop", "Any_acces_propietat_+1prop", "Manera_acces_propietat_+1prop","Manera_acces_propietat_+1prop_altres","Barri", "Barri_altres", "Codi_postal","Codi_postal_altres", "Any_fundacio", "N_assalariats", "Treballadors_1", "Treballadors_2", "Treballadors_3", "Treballadors_4", "Sector", "Importacio_Nacional", "Importacio_Europa","Importacio_intercontinental", "Importacio_No", "Exportacio_Nacional", "Exportacio_Europa","Exportacio_intercontinental", "Exportacio_No","N_sucursals", "Sucursal_fora_principal", "Pandemia", "Erto", "COVID_1", "COVID_2", "COVID_3", "COVID_4", "COVID_5", "COVID_6", "COVID_7", "COVID_8", "COVID_9", "Esforc_1", "Esforc_2", "Esforc_3", "Esforc_4", "Esforc_5", "Esforc_6", "Esforc", "Fills", "Situacio_sentimental", "Situacio_sentimental_altres", "Estudis_ESO", "Estudis_Batx", "Estudis_FP", "Estudis_dipl_uni", "Estudis_llic_uni", "Estudis_postgrau_doctorat", "Estudis_no_reglats","Estudis_altres", "Hores_benestar")

bbdd <- full_join(bbdd_caste,bbdd_cat)

bbdd <- bbdd %>%
  mutate(Genere_resposta = coalesce(`Genere_+1prop`, Genere_directiu, Genere_1prop),Any_naixement_resposta = coalesce(Any_naixement_directiu, `Any_naixement_+1prop`, Any_naixement_1prop), Any_acces = coalesce(`Any_acces_propietat_+1prop`, Any_acces_propietat_1prop, Any_acces_carrec_directiu))


#eliminem les persones que no han acceptat politica de privacitat i/o els que no han posat nom d'empresa.


bbdd <- bbdd %>%filter(!is.na(Barri))

#També eliminem els que han respost que no són ni propietaris ni directius. 

bbdd <- bbdd%>%filter(!(`Propietari?`=="No"&`Directiu?`=='No'))


bbdd <- bbdd %>% mutate(Genere_resposta = recode(Genere_resposta,"Masculino" = "M", "Masculí" = "M", "Femenino" = "F", "Femení" = "F"),Propietaris = recode(`Propietari?`, "Si, comparteixo l'empresa amb altres persones"="+1prop","Sí, comparto la empresa con otras personas"="+1prop","Si, sóc l'únic/a propietari/ària"= "1prop" , "Sí, soy el/la única propietario/a"="1prop", "No"="Directiu"),N_propietaris_directiu = recode(N_propietaris_directiu, "La empresa pertenece a varias personas" = "+1prop","L'empresa pertany a diverses persones" ="+1prop", "La empresa pertenece a una sola persona"="1prop", "L'empresa pertany a una sola persona"="1prop"),Treballadors_1 = recode(Treballadors_1, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente deacuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),  Treballadors_2 = recode(Treballadors_2, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente deacuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"), Treballadors_3 = recode(Treballadors_3, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente deacuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"), Treballadors_4 = recode(Treballadors_4, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente deacuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"), Sector = recode(Sector, "Comercio" = "Comerç", "Función pública" = "Funció pública", "Servicios de salud" = "Serveis de salut", "Servicios financieros, servicios profesionales" = "Serveis financers, serveis professionals", "Hotelería, restauración, turismo" = "Hoteleria, restauració, turisme", "Educación"  ="Educació", "Textiles, calzado" = "Tèxtils, calçat","Alimentación, bebidas, tabaco" = "Alimentació, begudes, tabac", "Construcción"  ="Construcció", "Producción de metales básicos" = "Producció de metalls bàsics","Medios de comunicación, cultura, industria gráfica" = "Mitjans de comunicació, cultura, indústria gràfica", "Ingeniería mecánica y eléctrica" = "Ingenyeria mecànica i elèctrica", "Transporte" = "Transport", "Agricultura, plantaciones, otros sectores rurales" = "Agricultura, plantacions, altres sectors rurals", "Industrias químicas" = "Indústries químiques", "Silvicultura, madera, celulosa, papel" = "Silvicultura, fusta, cel·lulosa, paper","Fabricación de material de transporte" = "Fabricació de material de transport", "Hotelería, restauració, turisme" ="Hoteleria, restauració, turisme" ), Importacio_Europa = recode(Importacio_Europa, "Europeo" = "Europeu"), Exportacio_Europa = recode(Exportacio_Europa, "Europeo" = "Europeu"), N_sucursals = recode(N_sucursals, "11 o más" = "11 o més"))

bbdd <- bbdd %>% mutate(Sucursal_fora_principal = recode(Sucursal_fora_principal, "Sí, en el resto de España" = "Espanya", "Si, a la resta d'Espanya"  ="Espanya", "Sí, en Cataluña" ="Catalunya", "Si, a Catalunya" = "Catalunya", "Sí, en Europa" ="Europa", "Si, a Europa"  ="Europa", "Sí, en el resto del mundo" = "Món"), COVID_1 = recode(COVID_1, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_2 = recode(COVID_2, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_3 = recode(COVID_3, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_4 = recode(COVID_4, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_5 = recode(COVID_5, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_6 = recode(COVID_6, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_7 = recode(COVID_7, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_8 = recode(COVID_8, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),COVID_9 = recode(COVID_9, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),Esforc_1 = recode(Esforc_1, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),Esforc_2 = recode(Esforc_2, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),Esforc_3 = recode(Esforc_3, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord", "Totalmente de acuerdo" = "Totalment d¡acord"),Esforc_4 = recode(Esforc_4, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),Esforc_5 = recode(Esforc_5, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"))

bbdd <- bbdd %>% mutate(Esforc_6 = recode(Esforc_6, "De acuerdo" = "D'acord", "Totalmente en desacuerdo" = "Totalment en desacord", "Totalmente de acuerdo" = "Totalment d'acord", "En desacuerdo" = "En desacord", "Ni de acuerdo ni en desacuerdo" = "Ni d'acord ni en desacord"),Situacio_sentimental = recode(Situacio_sentimental, "Con pareja" = "Amb parella", "Prefiero no contestar" = "Prefereixo no contestar", "Sin pareja"  ="Sense parella"),Estudis_ESO = if_else(is.na(Estudis_ESO), 0, 1), Estudis_Batx = if_else(is.na(Estudis_Batx), 0, 1), Estudis_FP = if_else(is.na(Estudis_FP), 0, 1),Estudis_dipl_uni = if_else(is.na(Estudis_dipl_uni), 0, 1), Estudis_llic_uni = if_else(is.na(Estudis_llic_uni), 0, 1), Estudis_postgrau_doctorat = if_else(is.na(Estudis_postgrau_doctorat), 0, 1), Estudis_no_reglats = if_else(is.na(Estudis_no_reglats), 0, 1), Estudis_altres = if_else(is.na(Estudis_altres), 0, 1), N_assalariats = recode(N_assalariats,"0.0"=0, "1 - 9" = 1, "10 - 49" = 2,  "50 - 199" = 3, "200 - 249"=4, "Más de 250" =5, "Més de 250" = 5), Importacio_Nacional = if_else(is.na(Importacio_Nacional), 0, 1),Importacio_Europa = if_else(is.na(Importacio_Europa), 0, 1),Importacio_intercontinental = if_else(is.na(Importacio_intercontinental), 0, 1), Importacio_No = if_else(is.na(Importacio_No),0,1),Exportacio_Nacional = if_else(is.na(Exportacio_Nacional), 0, 1),Exportacio_Europa = if_else(is.na(Exportacio_Europa), 0, 1),Exportacio_intercontinental = if_else(is.na(Exportacio_intercontinental), 0, 1), Exportacio_No = if_else(is.na(Exportacio_No),0,1))

bbdd <- bbdd %>% mutate(Hores_benestar = recode(Hores_benestar, "Más de 20h" = "Més de 20h"), Sucursal_fora_principal = recode(Sucursal_fora_principal, "Sí, en Cataluña" = "Catalunya"), Estudis_uni = coalesce(Estudis_dipl_uni, Estudis_llic_uni))

# elimino estudis llicenciatura i estudis diplomatura
bbdd <- bbdd %>% select(-Estudis_llic_uni, - Estudis_dipl_uni)

#ajuntem el genere de l'empresa
bbdd <- bbdd %>% mutate(Genere_empresa = coalesce(Genere_propietaris_directiu, Genere_propietari_directiu, `Genere_propietaris_+1prop`,Genere_1prop),Genere_empresa = recode(Genere_empresa, "Más hombres que mujeres" = "Més homes que dones", "Más mujeres que hombres" = "Més dones que homes"),Genere_empresa = ifelse(Propietaris=="1prop"& !is.na(Genere_resposta), Genere_resposta,Genere_empresa), Genere_empresa = recode(Genere_empresa, "Més dones que homes"  ="F", "Més homes que dones" = "M", "Proporcional" = "Mixt", "Masculí" ="M", "Masculino" ="M", "Femenino" ="F", "Femení"="F"))

#eliminem les variables "Genere_propietaris_+1prop", "Genere_propietari_directiu"
#eliminem les variables "Genere_1prop", "Genere_+1prop", "Genere_directiu"
#eliminem manera acces a la propietat 1prop i +1prop
bbdd <- bbdd %>% select(-c(Genere_propietari_directiu, Genere_propietaris_directiu,`Genere_propietaris_+1prop`,`Genere_+1prop`, Genere_1prop, Genere_directiu, Genere_directiu_altres))

# eliminem anys de naixement de propietaris...també els anys d'acces
bbdd <- bbdd %>% select(- c(Any_naixement_directiu, `Any_acces_propietat_+1prop`, Any_naixement_1prop, Any_acces_propietat_1prop, `Any_naixement_+1prop`, `Any_acces_propietat_+1prop`, Any_acces_carrec_directiu,`Directiu?`))

#També eliminem Politica de Privacitat i Empresa
bbdd <- bbdd %>%select(-c(Politica_Privacitat, Empresa, `Propietari?`))
```

Mirar si hi ha alguna empresa duplicada
```{r}
duplicados <- duplicated(bbdd)
bbdd[duplicados,]
# no hi ha duplicats
```

#canviar els NA de sucursal_fora_principal per 0. Ja que corresponen a 
```{r}
bbdd$Sucursal_fora_principal <- ifelse(bbdd$N_sucursals == "0.0", "No", bbdd$Sucursal_fora_principal)

```

Nombre de propietaris
```{r}
bbdd$N_propietaris <- ifelse(bbdd$Propietaris == "Directiu",
                            ifelse(bbdd$N_propietaris_directiu == "+1prop", "+1prop", "1prop"),
                            bbdd$Propietaris)
bbdd <- bbdd %>% select(-N_propietaris_directiu)
```



# Canviar categories Sector segons CIIU Rev. 4

```{r}
bbdd <- bbdd %>% mutate(Sector = recode(Sector,"Alimentació, begudes, tabac" = "C",
                                                "Serveis de salut" = "Q",
                                                "Comerç" = "G",
                                                "Tèxtils, calçat" = "C" ,
                                                "Construcció" = "F",
                                                "Hoteleria, restauració, turisme" = "I",
                                                "Educació" = "P",
                                                "Serveis financers, serveis professionals" = "K",
                                                "Producció de metalls bàsics" = "C",
                                                "Mitjans de comunicació, cultura, indústria gràfica" = "J",
                                                "Ingenyeria mecànica i elèctrica" =  "M",
                                                "Transport" = "H",
                                                "Agricultura, plantacions, altres sectors rurals" = "A",
                                                "Indústries químiques" = "C",
                                                "Silvicultura, fusta, cel·lulosa, paper" = "A",
                                                "Funció pública" = "O",
                                                "Servicios  públicos (agua, gas, electricidad)" = "O",
                                                "Fabricació de material de transport" = "C" ,
                                                "Medis de comunicació, cultura, indústria gràfica" = "J",
                                                "Ingeniería mecànica i elèctrica" =  "M",z = "O"))

bbdd <- bbdd %>% mutate(Sector = recode(Sector, "A" = "Agricultura", "C" = "Fabricació", "F" = "Construcció", "G" = "Serveis de mercat", "H" = "Serveis de mercat", "I" = "Serveis de mercat", "J" = "Serveis de mercat", "K" = "Serveis de mercat", "M" = "Serveis de mercat", "O" ="Serveis no de mercat", "P" = "Serveis no de mercat", "Q" = "Serveis no de mercat", "Servicios  públicos (agua, gas, electricidad)" = "Serveis no de mercat"))

```

# Estudis

```{r}
table(bbdd$Estudis_altres)

#canviar de binari a numero
bbdd <- bbdd %>% 
  mutate(
    Estudis_ESO = ifelse(Estudis_ESO == 1, 2, NA_real_),
    Estudis_Batx = ifelse(Estudis_Batx == 1, 3, NA_real_),
    Estudis_FP = ifelse(Estudis_FP == 1, 4, NA_real_),
    Estudis_uni = ifelse(Estudis_uni == 1, 4, NA_real_),
    Estudis_postgrau_doctorat = ifelse(Estudis_postgrau_doctorat == 1, 5, NA_real_),
    Estudis_no_reglats = ifelse(Estudis_no_reglats == 0, 0, 1),
    Estudis_altres = ifelse(Estudis_altres == 1, "Altres", NA_real_)
  )

#unir variables en una
bbdd <- bbdd %>% 
  mutate(Estudis = pmax(Estudis_ESO, Estudis_Batx, Estudis_FP, Estudis_uni, Estudis_postgrau_doctorat, na.rm = TRUE))

#eliminar les binaries
bbdd <- bbdd %>% select(-c(Estudis_ESO, Estudis_Batx, Estudis_FP, Estudis_postgrau_doctorat, Estudis_no_reglats, Estudis_uni, Estudis_altres))

# Altres estudis no reglat - 1
# ESO - 2
#Batx - 3
#FP - 4
#Uni - 4
# Postgraua, màster - 5

#Altres - 
```





# Ajuntar categories

Ajuntem categories situacio sentimental "altres" amb el que podem utilitzar fem el mateix amb situació sentimental

```{r}
table(bbdd$Situacio_sentimental_altres)
indices_other <- which(tolower(bbdd$Situacio_sentimental) == "other")
indices_viuda <- c(grep("(?i)viuda", bbdd$Situacio_sentimental_altres[indices_other]),grep("(?i)viudo", bbdd$Situacio_sentimental_altres[indices_other]))

bbdd$Situacio_sentimental[indices_other[indices_viuda]] <- "Sense parella"
indices_separada <- c(grep("(?i)Separada", bbdd$Situacio_sentimental_altres[indices_other]))
bbdd$Situacio_sentimental[indices_other[indices_separada]] <- "Sense parella"
bbdd$Situacio_sentimental_altres[indices_other[indices_separada]] <- NA
bbdd$Situacio_sentimental_altres[indices_other[indices_viuda]] <- NA

#eliminem la opció altres
bbdd <- bbdd %>% select(-Situacio_sentimental_altres)
```

Posar les opcions de "Altres" on toca. També ajuntem "Can Boada Casc Antic" i "Can Boada del Pi" en un sol barri.

```{r, barris_districtes}
table(bbdd$Barri)
indices_other <- which(tolower(bbdd$Barri) == "other")
indices_centre <- c(grep("(?i)Centre", bbdd$Barri_altres[indices_other]),grep("(?i)Centro", bbdd$Barri_altres[indices_other]),grep("(?i)Gavatxons", bbdd$Barri_altres[indices_other]),grep("(?i)Rambla", bbdd$Barri_altres[indices_other]))
bbdd$Barri[indices_other[indices_centre]] <- "Centre"

indices_esport <- grep("(?i)Esportiva", bbdd$Barri_altres[indices_other])
bbdd$Barri[indices_other[indices_esport]] <- "Poble Nou - Zona Esportiva"
bbdd$Barri_altres[indices_other[indices_esport]] <- NA


bbdd <- bbdd %>% mutate(Barri = recode(Barri, "Can Boada Casc Antic" = "Can Boada", "Can Boada del Pi" = "Can Boada") )
table(bbdd$Barri)

# ho ajuntem a districtes
bbdd <- bbdd %>% mutate(Districte = recode(Barri, "Antic Poble de Sant Pere" = "D1", "Ca n'Anglada" = "D2", "Ca n'Aurell" = "D4", "Can Boada" = "D5", "Can Jofresa" = "D3", "Can Palet" = "D3", "Can Palet de Vista Alegre" = "D4", "Can Parellada" = "D7", "Can Roca" = "D5", "Can Tusell" = "D6", "Cementiri Vell" = "D1", "Centre" = "D1", "Disseminats - D4" = "D4", "Ègara" = "D6", "La Cogullada" = "D4", "La Maurina" = "D4", "Les Arenes - La Grípia - Can Montllor" = "D6", "Les Fonts" ="D7", "P.I. Can Parellada" = "D3", "P.I. Can Petit" = "D6", "P.I. Catalunya - Esc. Industrial" = "D1", "P.I. Els Bellots" = "D3", "P.I. Santa Eulàlia" = "D3", "P.I. Santa Margarida" = "D3", "Pla del Bon Aire" = "D5", "Poble Nou - Zona Esportiva" = "D5", "Roc Blanc" = "D4", "Sant Llorenç" = "D6", "Sant Pere" = "D5", "Sant Pere Nord" = "D6", "Segle XX" = "D3", "Torrent d'en Pere Parres" = "D5", "Vallparadís" = "D1", "Montserrat" = "D2", "P.I. Puigbarral"  ="D6", "Disseminats - D2" ="D2", "Disseminats - D6" ="D6", "Torre Sana" = "D2"))

bbdd <- bbdd %>% select(- Barri, - Codi_postal)

# eliminem la variable barri_altres

bbdd <- bbdd %>% select(-Barri_altres, - Codi_postal_altres)
```

Hi ha moltes opcions de Manera d'accès a la direcció que és per familiars. S'afageix a les opcions

```{r}
table(bbdd$Manera_acces_carrec_directiu_altres)

indices_other <- c(which(tolower(bbdd$Manera_acces_carrec_directiu) == "altres"),which(tolower(bbdd$Manera_acces_carrec_directiu) == "other"))

indices_familia <- c(grep("(?i)Familiar", bbdd$Manera_acces_carrec_directiu_altres[indices_other]), grep("(?i)Marido", bbdd$Manera_acces_carrec_directiu_altres[indices_other]),grep("(?i)Parentesco", bbdd$Manera_acces_carrec_directiu_altres[indices_other]),grep("(?i)Coneixement directe", bbdd$Manera_acces_carrec_directiu_altres[indices_other]),grep("(?i)Conocian", bbdd$Manera_acces_carrec_directiu_altres[indices_other]))

bbdd$Manera_acces_carrec_directiu[indices_other[indices_familia]] <- "Familiar"

bbdd$Manera_acces_carrec_directiu_altres[indices_other[indices_familia]] <- NA

bbdd <- bbdd %>% select(-Manera_acces_carrec_directiu_altres)

# Passa el mateix amb la manera d'accès dels que tenen propietat compartida
table(bbdd$Manera_acces_1prop_altres)
table(bbdd$`Manera_acces_propietat_+1prop_altres`)
indices_other <- which(tolower(bbdd$`Manera_acces_propietat_+1prop`) == "other")

indices_familia <- c(grep("(?i)Familiar", bbdd$`Manera_acces_propietat_+1prop_altres`[indices_other]),grep("(?i)Mujer", bbdd$`Manera_acces_propietat_+1prop_altres`[indices_other]),grep("(?i)Esposa", bbdd$`Manera_acces_propietat_+1prop_altres`[indices_other]))

bbdd$`Manera_acces_propietat_+1prop`[indices_other[indices_familia]] <- "Familiar"

indices_compra <- c(grep("(?i)Compra", bbdd$`Manera_acces_propietat_+1prop_altres`[indices_other]))

bbdd$`Manera_acces_propietat_+1prop`[indices_other[indices_compra]] <- "Adquisició"


bbdd$`Manera_acces_propietat_+1prop_altres`[indices_other[indices_compra]] <- NA
bbdd$`Manera_acces_propietat_+1prop_altres`[indices_other[indices_familia]] <- NA


bbdd <- bbdd %>% mutate(Manera_acces_propietat = coalesce(Manera_acces_1prop, `Manera_acces_propietat_+1prop`))


bbdd <- bbdd %>% mutate(Manera_acces_propietat = recode(Manera_acces_propietat, "Adquirí la empresa" = "Adquisició", "Fusión/Adquisición de la empresa" = "Fusió", "He fundado la empresa" = "Fundació", "He fundat la empresa"  ="Fundació", "Herdé la empresa" = "Herència","Heredé la empresa" = "Herència", "Other" ="Altres", "Heredé participaciones en la empresa" = "Herència", "La empresa la fundamos varios/as socios/as" = "Fundació","Soy el fundador principal de la empresa" ="Fundació", "L'empresa la vam fundar diversos/es socis/es" ="Fundació", "Vaig adquirir l'empresa" ="Adquisició","Vaig heretar participaciones en l'empresa" ="Herència", "Sóc el fundador principal de l'empresa" ="Fundació"), Manera_acces_carrec_directiu = recode(Manera_acces_carrec_directiu, "Promoción interna" = "Promoció interna", "Proceso selección" = "Procés de selecció", "Other" = "Altres"))

bbdd <- bbdd %>% select(- c(Manera_acces_1prop_altres, Manera_acces_1prop, `Manera_acces_propietat_+1prop`, `Manera_acces_propietat_+1prop_altres`))
```


Passar les variables a factor o numeric:

```{r}
#Select var factor
afactor<-select(bbdd,-ID, -Any_naixement_resposta, -Any_acces, -Any_fundacio, -Esforc, -Fills, - `N_propietaris_+1prop`)
#Vector var factor
names<-names(afactor)
#Cambio a factor
bbdd[names]<-lapply(bbdd[names], factor)


num<-select(bbdd, Any_naixement_resposta, Any_acces, Any_fundacio, Esforc, Fills)
nom <- names(num)
bbdd[nom] <- lapply(bbdd[nom], as.numeric)
```

#ALPHA - CRONBACH

- Alpha Cronbach - Esforç
```{r, alpha-esforç}
#re codificar les respostes per a que les inverses coincideixin i es puguin comparar.

#posar categories en 1 2 3 4 5 i calcular la covariança. Ha de sortir positiva tota. Abans s'ha de fer els canvis de 1-5.

bbdd <- bbdd %>% mutate(Esforc_1 = recode(Esforc_1, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"), Esforc_2 = recode(Esforc_2,"Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"), Treballadors_1 = recode(Treballadors_1, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"), Treballadors_4 = recode(Treballadors_4,"Totalment d'acord" = "1", "D'acord" = "2", "En desacord" = "4", "Totalment en desacord" = "5", "Ni d'acord ni en desacord" = "3"), Esforc_3 = recode(Esforc_3, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"), Esforc_4 = recode(Esforc_4, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"), Esforc_5 = recode(Esforc_5, "Totalment d'acord" = "1", "D'acord" = "2", "En desacord" = "4", "Totalment en desacord" = "5", "Ni d'acord ni en desacord" = "3"), Treballadors_2 = recode(Treballadors_2, "Totalment d'acord" = "1", "D'acord" = "2", "En desacord" = "4", "Totalment en desacord" = "5", "Ni d'acord ni en desacord" = "3"), Treballadors_4 = recode(Treballadors_4, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"), Esforc_6 = recode(Esforc_6, "Totalment en desacord" = "5", "En desacord" = "4", "Ni d'acord ni en desacord" ="3", "D'acord" = "2", "Totalment d'acord" ="1"), Treballadors_3 = recode(Treballadors_3,"Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"))

Esforc_no_treballadors <- subset(bbdd,  N_assalariats !=0,select = c("Esforc_1", "Esforc_2", "Esforc_3", "Esforc_4", "Esforc_5", "Esforc_6"))

Esforc_no_treballadors <- Esforc_no_treballadors[complete.cases(Esforc_no_treballadors),]
 
Esforc_no_treballadors <- Esforc_no_treballadors %>% mutate(Esforc_1 = as.numeric(Esforc_1),Esforc_2 = as.numeric(Esforc_2),Esforc_3 = as.numeric(Esforc_3),Esforc_4 = as.numeric(Esforc_4),Esforc_5 = as.numeric(Esforc_5), Esforc_6 = as.numeric(Esforc_6))

Esforc_treballadors <- select(bbdd,Esforc_1, Esforc_2, Esforc_3, Esforc_4, Esforc_5, Esforc_6, Treballadors_1, Treballadors_2, Treballadors_3, Treballadors_4) 
Esforc_treballadors <- subset(Esforc_treballadors, complete.cases(Esforc_treballadors))
Esforc_treballadors <- Esforc_treballadors %>% mutate(Treballadors_1 = as.numeric(Treballadors_1),Treballadors_2 = as.numeric(Treballadors_2),Treballadors_3 = as.numeric(Treballadors_3),Treballadors_4 = as.numeric(Treballadors_4),Esforc_1 = as.numeric(Esforc_1),Esforc_2 = as.numeric(Esforc_2),Esforc_3 = as.numeric(Esforc_3),Esforc_4 = as.numeric(Esforc_4),Esforc_5 = as.numeric(Esforc_5), Esforc_6 = as.numeric(Esforc_6))

#sense treballadors
round(cov(Esforc_no_treballadors),2) #variable Esforc_5[-5]
round(cov(Esforc_no_treballadors[-5]),2)

alpha_esforc_treballadors_5 <- alpha(Esforc_no_treballadors[-5]) #eliminant esforc_5 
alpha_esforc_treballadors_5$total$raw_alpha

# amb treballadors
round(cov(Esforc_treballadors),2) #variable Esforc_5[-5] negatius 
round(cov(Esforc_treballadors[-5]),2) #matriu treballadors_4[10] i Esforc_3[3]
round(cov(Esforc_treballadors[-c(3,5)]),2) #sense esforc_3 ni esforc_5
round(cov(Esforc_treballadors[-c(5,10)]),2) #sense treballadors_4 ni esforc_5

alpha_esforc_treballadors_510 <- alpha(Esforc_treballadors[-c(5, 10)]) #eliminant esforc_5 i treballadors_4
alpha_esforc_treballadors_510$total$raw_alpha
alpha_esforc_35 <- alpha(Esforc_treballadors[-c(3,5)])# eliminant esforc_3 i esforc_5
alpha_esforc_35$total$raw_alpha
```

-   Alpha de cronbach - COVID

```{r, alpha-covid}
bbdd <- bbdd %>% mutate(COVID_1 = recode(COVID_1, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5") ,COVID_2 = recode(COVID_2, "Totalment d'acord" = "1", "D'acord" = "2", "En desacord" = "4", "Totalment en desacord" = "5", "Ni d'acord ni en desacord" = "3"),COVID_3 = recode(COVID_3, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"),COVID_4 = recode(COVID_4, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"),COVID_5 = recode(COVID_5, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" ="3", "D'acord" = "4", "Totalment d'acord" ="5"),COVID_6 = recode(COVID_6, "Totalment d'acord" = "1", "D'acord" = "2", "En desacord" = "4", "Totalment en desacord" = "5", "Ni d'acord ni en desacord" = "3"),COVID_7 = recode(COVID_7, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" = "3", "D'acord" = "4", "Totalment d'acord" = "5"),COVID_8 = recode(COVID_8, "Totalment d'acord" = "1", "D'acord" = "2", "En desacord" = "4", "Totalment en desacord" = "5", "Ni d'acord ni en desacord" = "3"),COVID_9 = recode(COVID_9, "Totalment en desacord" = "1", "En desacord" = "2", "Ni d'acord ni en desacord" = "3", "D'acord" = "4", "Totalment d'acord" = "5"))
covid <- data.frame(bbdd$COVID_1,bbdd$COVID_2,bbdd$COVID_3,bbdd$COVID_4,bbdd$COVID_5,bbdd$COVID_6,bbdd$COVID_7,bbdd$COVID_8,bbdd$COVID_9)

covid <- covid[complete.cases(covid),]
covid <- covid %>% mutate(bbdd.COVID_1 = as.numeric(bbdd.COVID_1),bbdd.COVID_2 = as.numeric(bbdd.COVID_2),bbdd.COVID_3 = as.numeric(bbdd.COVID_3),bbdd.COVID_4 = as.numeric(bbdd.COVID_4),bbdd.COVID_5 = as.numeric(bbdd.COVID_5),bbdd.COVID_6 = as.numeric(bbdd.COVID_6),bbdd.COVID_7 = as.numeric(bbdd.COVID_7),bbdd.COVID_8 = as.numeric(bbdd.COVID_8),bbdd.COVID_9 = as.numeric(bbdd.COVID_9))

round(cov(covid),2)#6 i 8 problematiques

c <- alpha(cov(covid))
c$total$raw_alpha
```

Com no es poden utilitzar aquestes variables, s'eliminen de la base de dades
```{r}
bbdd <- bbdd %>% select(-c(Treballadors_1, Treballadors_2, Treballadors_3, Treballadors_4, COVID_1, COVID_2, COVID_3, COVID_4, COVID_5, COVID_6, COVID_7, COVID_8, COVID_9, Esforc_1, Esforc_2, Esforc_3, Esforc_4, Esforc_5, Esforc_6, Pandemia, Erto))
```





  # Variables EDat

Creem variables edat i edat acces

```{r}
bbdd <- bbdd %>% mutate(Edat_acces = as.numeric(Any_acces) - as.numeric(Any_naixement_resposta))

bbdd <- bbdd %>% mutate(Edat = 2023- as.numeric(Any_naixement_resposta))

bbdd <- bbdd %>% mutate(Anys_empresa =  2023 - as.numeric(bbdd$Any_acces))

```


# Mirem variables poc informatives i variables amb poca informació

```{r, variables poca informació}
require(tidyverse)
data_long <- bbdd%>%gather(key = "variable", value = "valor")
data_long %>%group_by(variable) %>%
dplyr::summarize(porcentaje_NA = 100 * sum(is.na(valor)) / length(valor)) %>%ggplot(aes(x = reorder(variable, desc(porcentaje_NA)), y = porcentaje_NA)) +
geom_col() +labs(title = "Percentatge de valors perduts",
x = "Variable", y = "NA's") +theme_bw()+ theme(axis.text.x=element_text(angle=90))

table(bbdd$Propietaris)
1 - 68/(125+60+68) # directius = 26.88% 

library(caret)

nzv_vars <- nearZeroVar(bbdd)
bbdd[,nzv_vars] # Estudis_altres
```

Veiem que hi ha variables amb NA's, però ja són normals, ja que no totes les empreses han de contestar les preguntes de Treballadors, si no en tenen (autònoms), no contestaran. El mateix passa amb el COVID. Si la persona que contesta no ha estat dins l'empresa durant el covid o l'empresa s'ha fundat després de la pandèmia, ja és normal que lespreguntes de covid no les contestin. El mateix passa amb la variable sucursal_fora_principal, si l'empresa només té una sucursal, ja no ha de respondre si en té alguna més fora de la principal. La variable barri_altres, ja s'ha utilitzat, per tant es pot eliminar. --- NO FER GAIRE CAS


# Categories amb menys de 5%
Poca representació univariant

```{r}
#Select var factor
afactor<-select(bbdd,-ID, -Any_naixement_resposta, -Any_acces, -Any_fundacio, -Esforc, -Fills, - `N_propietaris_+1prop`, -Edat, -Any_acces, -Anys_empresa, -Edat_acces)
#Vector var factor
names<-names(afactor)
#Cambio a factor
bbdd[names]<-lapply(bbdd[names], factor)


num<-select(bbdd, Any_naixement_resposta, Any_acces, Any_fundacio, Esforc, Fills)
nom <- names(num)
bbdd[nom] <- lapply(bbdd[nom], as.numeric)


repre <- function(var, perc){
  vector <- numeric()
  for(i in 1:length(var)){
    subs <- subset(bbdd,select=var[i])
    taula <- table(subs)/sum(!is.na(subs)) < perc
    if(any(taula)==TRUE){
      vector <- c(vector, i)
    }
  }
  return(vector)
}
repre(names, 0.05)
names[repre(names, 0.05)]

# Sector = Agricultura (2) -> ho elimino?
#Situacio_sentimental -> Other(otros compromisos, 1) 
#Districte -> hi ha un que es other
# Manera_acces_propietat: de les opcions "Altres" he tret "familiar", i no arriba al 5%, si ho torno a ficar tampoc arribaria al 5%. "Fusió" tampoc arriba al 5%
```
Ajuntem les categories de més assalariats, ja que cap de les dues arriba al 5%. Igual amb N_sucursals

```{r}
bbdd <- bbdd %>% mutate(N_assalariats = recode(N_assalariats, "5" = "3", "4" = "3"))
# tot i aquest canvi la categoria 4 (la unió) no arriba al 5%

bbdd <- bbdd %>% mutate(N_sucursals = recode(N_sucursals, "11 o més" = "Més de 5", "6 - 10" = "Més de 5"))
```


Mira que no hi hagi cap categoria que amb genere empresa dongui < 5%

```{r}
# Función para hacer tabla de contingencia
conTab <- function(var, grup){
  df <- table(subset(bbdd,select=c(var,grup)),useNA = "no" )  
  noms_poc_inf <- numeric()
  if(any(round(prop.table(df,2),3)<0.05)==TRUE | any(round(prop.table(df,2),3)==0)==TRUE){
    return(round(prop.table(df,2),3))
    }

  else{return(paste("La variable", var, "no tiene valores <5%"))}
}

variables_personal <- names(select(bbdd,Situacio_sentimental, ))
lapply(names,conTab, grup="Genere_empresa")


#Manera_acces_carrec_directiu
#N_propietaris_directiu
# N_assalariats
# Sector
# N_sucursals
# Sucursal_fora_principal
# Pandemia
# Erto
#Situacio_sentimental
# Estudis_altres
#Estudis
# Propietaris
# Districte
#Manera_acces_propietat

```

Esto que hace? crec que el mateix que l'anterior ._.


```{r, eval=FALSE}

# Función para hacer tabla de contingencia
conTab <- function(var,useNA = "no"){  
  
  df <- table(subset(bbdd,select=c(var,"Genere_empresa")),useNA = useNA )
  suma <- colSums(df)
  tab <- numeric()
  for(i in 1:nrow(df)){
    tab <- c(tab,df[i,]/suma)
  }
  tab <- round(matrix(tab, ncol = 3, byrow=T),2)
  
  return(tab)
}

lapply(names,conTab,useNA="if")
```








# Anàlisis univariant dades numèriques: VALORS EXTREMS

```{r, eval=FALSE}
#any naixement
ggplot(bbdd, aes(x=Any_naixement_resposta))+geom_boxplot()+
  geom_point(aes(x = min(bbdd$Any_naixement_resposta), y = 0), size = 1) +
  geom_point(aes(x = max(bbdd$Any_naixement_resposta), y = 0), size = 1) +
  annotate("text", x=min(bbdd$Any_naixement_resposta), y=-0.1, 
           label=paste0(min(bbdd$Any_naixement_resposta)), size=3) +
  annotate("text", x=max(bbdd$Any_naixement_resposta), y=-0.1, 
           label=paste0(max(bbdd$Any_naixement_resposta)), size=3)

#Edat
ggplot(bbdd, aes(x=Edat))+geom_boxplot()+
  geom_point(aes(x = min(bbdd$Edat), y = 0), size = 1) +
  geom_point(aes(x = max(bbdd$Edat), y = 0), size = 1) +
  annotate("text", x=min(bbdd$Edat), y=-0.1, 
           label=paste0(min(bbdd$Edat)), size=3) +
  annotate("text", x=max(bbdd$Edat), y=-0.1, 
           label=paste0(max(bbdd$Edat)), size=3)

#Edat acces
# Eliminar filas con valores faltantes
bbdd_edat <- bbdd[!is.na(bbdd$Edat_acces_propietat),]

ggplot(bbdd_edat, aes(x=bbdd_edat$Edat_acces_propietat))+geom_boxplot()+
  geom_point(aes(x = min(bbdd_edat$Edat_acces_propietat), y = 0), size = 1) +
  geom_point(aes(x = max(bbdd_edat$Edat_acces_propietat), y = 0), size = 1) +
  annotate("text", x=min(bbdd_edat$Edat_acces_propietat), y=-0.1, 
           label=paste0(min(bbdd_edat$Edat_acces_propietat)), size=3) +
  annotate("text", x=max(bbdd_edat$Edat_acces_propietat), y=-0.1, 
           label=paste0(max(bbdd_edat$Edat_acces_propietat)), size=3)

bbdd[bbdd$Edat_acces_propietat<16&!is.na(bbdd$Edat_acces_propietat),]#un cas de 12 anys

#Any fundacio
ggplot(bbdd, aes(x=Any_fundacio))+geom_boxplot()+
  geom_point(aes(x = min(bbdd$Any_fundacio), y = 0), size = 1) +
  geom_point(aes(x = max(bbdd$Any_fundacio), y = 0), size = 1) +
  annotate("text", x=min(bbdd$Any_fundacio), y=-0.05, 
           label=paste0(min(bbdd$Any_fundacio)), size=3) +
  annotate("text", x=max(bbdd$Any_fundacio), y=-0.05, 
           label=paste0(max(bbdd$Any_fundacio)), size=3)

summary(bbdd$Any_fundacio) #el minim es 2.007, es canvia a 2007
bbdd$Any_fundacio <- replace(bbdd$Any_fundacio,bbdd$Any_fundacio==min(bbdd$Any_fundacio, na.rm = TRUE), 2007)

bbdd_caste[bbdd_caste$Any_fundacio<10,]




boxplot(as.numeric(bbdd$Edat_acces), horizontal=TRUE)
bbdd[bbdd$Edat_acces<20,]
ggplot(bbdd, aes(x=as.numeric(Edat_acces)))+geom_boxplot()

min(bbdd$Edat_acces)

bbdd[bbdd$Edat_acces<20,]#valor no útil. No té sentit. No tindrem en compte aquesta resposta per analisis d'anys.

# com tenim files on les dates no tenen sentit(edat_acces<16 , o Any_acces<Any_fundacio), agafem només aquelles que si que tenen sentit

bbdd[bbdd$Any_acces<bbdd$Any_fundacio | bbdd$Edat_acces<16,] #9persones han contestat malament
nrow(bbdd)
```
# VALORS DISCREPANTS

```{r, importacio_exportacio}
importacio <- select(bbdd, Importacio_Nacional, Importacio_Europa, Importacio_intercontinental, Importacio_No)

importacio <- importacio %>% mutate(Importacio_Nacional = as.numeric(as.character(Importacio_Nacional)), Importacio_Europa = as.numeric(as.character(Importacio_Europa)), Importacio_intercontinental = as.numeric(as.character(Importacio_intercontinental)), Importacio_No = as.numeric(as.character(Importacio_No)))
for(i in 1:nrow(importacio)){
  if(importacio$Importacio_No[i]=="1"){
    s <- sum(importacio[i,])
    if(s!="1")
      print(c(importacio[i,],i))
  }
  
}


exportacio <- select(bbdd, Exportacio_Nacional, Exportacio_Europa, Exportacio_intercontinental, Exportacio_No)
exportacio <- exportacio %>% mutate(Exportacio_Nacional = as.numeric(as.character(Exportacio_Nacional)), Exportacio_Europa = as.numeric(as.character(Exportacio_Europa)), Exportacio_intercontinental = as.numeric(as.character(Exportacio_intercontinental)), Exportacio_No = as.numeric(as.character(Exportacio_No)))

for(i in 1:nrow(exportacio)){
  if(exportacio$Exportacio_No[i]==1){
    s <- sum(exportacio[i,])
    if(s!=1)
      print(c(exportacio[i,],i))
  }
  
}

#cas 179 i 238
```

Miro que el gènere del propietaris sigui coherent amb el gènere de l'empresa

```{r, genere_coherent}
subset(bbdd, Genere_resposta == "Femenino" & (Genere_empresa == "Masculino") | 
      Genere_resposta == "Masculino" & (Genere_empresa == "Femenino")) #no n'hi ha cap
```

Any acces a la propietat o direccio ha de ser major o igual a l'any de fundació
```{r}
subset(bbdd, Any_acces < round(Any_fundacio, 0) & !is.na(Any_acces) & !is.na(Any_fundacio))# hi ha dos casos que varien d'un any amunt 
```                                           



#DEscriptiva taules contingència

```{r}
table(bbdd$Propietaris, bbdd$Genere_resposta)
table(bbdd$Genere_resposta, bbdd$Genere_empresa)
table(bbdd$Genere_empresa)
table(bbdd$Any_naixement_resposta)
table(bbdd$Codi_postal)
table(bbdd$Importacio_No)

table(bbdd$Sector)

t <-table(bbdd$Genere_empresa)
round(c(t[1]/sum(t)*100,t[2]/sum(t)*100,t[3]/sum(t)*100),2)
```

#grafic geogràfic respostes Terrassa

```{r}
library(sf)
library(rgdal)

datos_mapa <- readOGR(dsn = "C:/Users/irene/OneDrive/Escritorio/irene/UNI/TFG/pt_dist.shp", layer="pt_dist")

respostes <- read_excel("respostes_districtes.xlsx")
# Obtener las coordenadas del centro de cada polígono de distrito
centros <- st_centroid(sf::st_as_sf(datos_mapa, coords = c("long", "lat")))

# Crear un objeto de datos que contenga los nombres de los distritos y sus coordenadas
nombres_distritos <- data.frame(DISTRICTE = unique(datos_mapa$DISTRICTE),
                                nombre = c("D1", "D2", "D3", "D4","D5", "D6", "D7"),
                                coords = centros)

####
datos_mapa_sf <- st_as_sf(datos_mapa, coords = c("long", "lat"), crs = 25831)
datos_mapa_sf <- datos_mapa_sf[order(datos_mapa_sf$DISTRICTE),]

ggplot() +
  geom_sf(data = datos_mapa_sf, aes(fill = respostes$Respostes, group=DISTRICTE)) +
  geom_sf_text(data = datos_mapa_sf, aes(label = nombres_distritos$nombre),color = "black",                 size = 2, nudge_x = 0, nudge_y = 0) + # Añade los nombres de los distritos
  geom_sf_label(data = datos_mapa_sf, aes(label = respostes$Respostes), color = "black",                 size = 2, nudge_x = 0, nudge_y = 0) + # Añade el número de respuestas
  scale_fill_gradient(low = "white", high = "blue")+ theme_minimal()+
  theme(plot.title = element_text(size=10))



ggplot() +
  geom_sf(data = datos_mapa_sf, aes(fill = respostes$Respostes, group=DISTRICTE)) +
  geom_sf_text(data = datos_mapa_sf, aes(label = nombres_distritos$nombre), color = "black", size = 2, nudge_x = 0, nudge_y = 5) + # Añade los nombres de los distritos
  geom_sf_label(data = datos_mapa_sf, aes(label = respostes$Respostes), color = "black", size = 2, nudge_x = 2, nudge_y = 1.5, fill = NA, label.padding = unit(0.15, "lines"), label.r = unit(0, "lines"), label.size = 0) + # Añade el número de respuestas
  scale_fill_gradient(low = "white", high = "blue") + 
  theme_minimal() +
  theme(axis.text = element_text(size = 6))
```

# GRÀFICS UNIVARIANTS

-   Per tipus d'enquestat (directiu, propietari o propietari amb empresa compartida)

```{r}
counts <- table(bbdd$Propietaris)
counts[2] <- counts[2]+counts[1];counts <- counts[-1]
per <- round(counts/sum(counts) * 100, 1)

df <- data.frame(categories = c("Propietaris", "Directius"), counts = as.numeric(counts), per = per)

pduen <- ggplot(data = df, aes(x = "", y = counts, fill = categories)) + 
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar(theta = "y") +
  theme_void() +
  scale_fill_manual(values = c("Directius" = "#b2d8b2", "Propietaris" = "#FFA07A")) +
  geom_text(aes(label = paste0(counts, "\n", per, "%")),
            position = position_stack(vjust = 0.5)) +
  ggtitle("Directors vs. Propietaris")
```

-   Gènere de resposta

```{r}
counts <- table(bbdd$Genere_resposta)
per <- round(counts/sum(counts) * 100, 1)
df <- data.frame(categories = names(counts), counts = as.numeric(counts), per = per)

pgen <- ggplot(data = df, aes(x = "", y = counts, fill = categories)) + 
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar(theta = "y") +
  theme_void() +
  scale_fill_manual(values = c("F" = "#B4DCE7", "M" = "#F8D3A5")) +
  geom_text(aes(label = paste0(counts, "\n", per, "%")),
            position = position_stack(vjust = 0.5))+
  ggtitle("Gènere de resposta")

```

-   Gènere d'empresa

```{r}
counts <- table(bbdd$Genere_empresa)
per <- round(counts/sum(counts) * 100, 1)
df <- data.frame(categories = names(counts), counts = as.numeric(counts), per = per)

pgenemp <- ggplot(data = df, aes(x = "", y = counts, fill = categories)) + 
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar(theta = "y") +
  theme_void() +
  scale_fill_manual(values = c("F" = "#B4DCE7", "M" = "#F8D3A5", "Mixt" = "#D3D3D3")) +
  geom_text(aes(label = paste0(counts, "\n", per, "%")),
            position = position_stack(vjust = 0.5))+
  ggtitle("Gènere d'empresa")
```

-   Propietaris: únic propietari o conjunt de propietaris

```{r}
counts <- table(bbdd$Propietaris)[-3]
per <- round(counts/sum(counts) * 100, 1)
df <- data.frame(categories = names(counts), counts = as.numeric(counts), per = per)

punduen <- ggplot(data = df, aes(x = "", y = counts, fill = categories)) + 
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar(theta = "y") +
  theme_void() +
  scale_fill_manual(values = c("1prop" = "#B5EAD7", "+1prop" = "#3AAFA9")) +
  geom_text(aes(label = paste0(counts, "\n", per, "%")),
            position = position_stack(vjust = 0.5))+
  ggtitle("Un propietari vs. Conjunt propietaris")
```

-   Sector

```{r, eval=FALSE}
counts <- table(bbdd$Sector)
names(counts) <- levels(bbdd$Sector)
per <- round(counts/sum(counts) * 100, 1)
df <- data.frame(Sectors_economics = names(counts), counts = as.numeric(counts), per = per)

psec <- ggplot(data = df, aes(x = "", y = counts, fill = Sectors_economics)) + 
  geom_bar(width = 1, stat = "identity", color = "white") +
  coord_polar(theta = "y") +
  theme_void() +
  scale_fill_manual(values = c("Agricultura" = "#808080", "Serveis de mercat" = "#87CEFA", "Serveis de no mercat" = "blue", "Construcció" = "pink", "Fabricació" = "purple")) +
  geom_text(aes(label = paste0(counts, "\n", per, "%")),
            position = position_stack(vjust = 0.5))+
  ggtitle("Un propietari vs. Conjunt propietaris")
```

-   Edat resposta

```{r}
grupos_edad <- cut(bbdd$Edat, breaks=seq(15,85, by=5))
df <- data.frame(bbdd$Edat)
df$grupos_edad <- cut(df$bbdd.Edat, seq(15, 80, by = 5), right = FALSE)
freq_edad <- table(df$grupos_edad)
df_freq_edad <- data.frame(grupos_edad = as.character(names(freq_edad)), freq = as.numeric(freq_edad))

pedat <- ggplot(data = df_freq_edad, aes(x = grupos_edad, y = freq)) +
  geom_bar(stat = "identity", fill = "#B4DCE7") +
  labs(x = "Edad", y = "Frecuencia") +
  ggtitle("Histograma d'edats agrupades de 5 en 5") +
  theme_minimal()
```

-   Edat acces al lloc treball

```{r}
grupos_edad <- cut( bbdd$Edat_acces[!is.na(bbdd$Edat_acces)], breaks=seq(15,65, by=5))
#df <- data.frame(bdf$anys)
#df$grupos_edad <- cut(df$bdf.anys, seq(15, 65, by = 5), right = FALSE)
freq_edad <- table(grupos_edad)
df_freq_edad <- data.frame(grupos_edad = as.character(names(freq_edad)), freq = as.numeric(freq_edad))

panys <- ggplot(data = df_freq_edad, aes(x = grupos_edad, y = freq)) +
  geom_bar(stat = "identity", fill = "#B4DCE7") +
  labs(x = "Edad", y = "Frecuencia") +
  ggtitle("Histograma d'edat d'accés de 5 en 5") +
  theme_minimal()
```

-   Anys que porten a la posició actual (anys empresa)

```{r}

df <- data.frame(bbdd$Anys_empresa)
df$bbdd.Anys_empresa <- as.numeric(df$bbdd.Anys_empresa)
df$grupos_edad <- cut(df$bbdd.Anys_empresa, seq(0, 50, by = 5), right = FALSE)

orden_niveles <- c("[0,5)", "[5,10)", "[10,15)", "[15,20)", "[20,25)", "[25,30)", "[30,35)", "[35,40)", "[40,45)", "[45,50)")
df$grupos_edad <- factor(df$grupos_edad, levels = orden_niveles)

freq_edad <- table(df$grupos_edad)
df_freq_edad <- data.frame(grupos_edad = as.character(names(freq_edad)), freq = as.numeric(freq_edad))

pandir <- ggplot(data = df_freq_edad, aes(x = grupos_edad, y = freq)) +
  geom_bar(stat = "identity", fill = "#B4DCE7") +
  labs(x = "Anys", y = "Frecuencia") +
  ggtitle("Histograma anys a la posició actual de 5 en 5") +
  theme_minimal() +
  scale_x_discrete(limits = orden_niveles)
```

# GRÀFIC BIVARIANT

```{r, fig.width=3, fig.height=3}
# Calcular los porcentajes
porcentajes <- bbdd %>%
  filter(Manera_acces_propietat %in% c("Fundació", "Adquisició", "Herència", "Fusió", "Altres")) %>%
  group_by(Manera_acces_propietat, Genere_empresa) %>%
  summarise(freq = sum(!is.na(Genere_empresa))) %>%
  group_by(Manera_acces_propietat) %>%
  mutate(porcentaje = freq / sum(freq) * 100) %>%
  invisible()


# Crear el gráfico de columna apilada
suppressMessages({
  ggplot(porcentajes, aes(x = Manera_acces_propietat, y = freq, fill = Genere_empresa)) +
    geom_bar(stat = "identity", position = "stack") +
    geom_text(aes(label = paste0(round(porcentaje, 1), "%"), 
                  y = freq, 
                  group = Genere_empresa), 
              position = position_stack(vjust = 0.5),
              size = 3, 
              color = "black") +
    scale_y_continuous(labels = scales::comma) +
    labs(title = "Distribución de género según tipo de trabajo",
         x = "Tipo de trabajo",
         y = "Porcentaje") +
    scale_fill_manual(values = c("F" = "#B4DCE7", "M" = "#F8D3A5", "Mixt" = "#D3D3D3")) +
    theme_minimal()
})
```

-   Gènere Empresa vs. Manera d'accès a la propietat

```{r}
# GENERO EMPRESA VS. MANERA PROPIETARI
library(ggplot2)
library(dplyr)

perc_manera_acces_propietat <- bbdd %>% filter(Manera_acces_propietat %in% unique(bbdd$Manera_acces_propietat)) %>%  group_by(Manera_acces_propietat, Genere_empresa) %>%
  summarise(freq = sum(!is.na(Genere_empresa))) %>%  group_by(Manera_acces_propietat) %>%
  mutate(porcentaje = freq / sum(freq) * 100)

ggplot(na.omit(perc_manera_acces_propietat), aes(x = Manera_acces_propietat, y = freq, fill = Genere_empresa)) +
  geom_bar(stat = "identity", position = "stack") +
  scale_y_continuous(labels = scales::comma) +
  geom_text(aes(label = round(porcentaje,2)), position = position_stack(vjust = 0.5), size=2) +
  labs(title = "Distribución de género según tipo de trabajo",
       x = "Manera d'accès a la propietat",
       y = "Porcentaje") +
  theme_minimal() 
```

-   Únic propietari o conjunt de propietaris segons el gènere d'empresa

```{r, fig.width=3, fig.height=3}
porcentajes <- bbdd %>%
  filter(Propietaris %in% c("1prop", "+1prop")) %>%
  group_by(Propietaris, Genere_empresa) %>%
  summarise(freq = sum(!is.na(Genere_empresa))) %>%
  group_by(Propietaris) %>%
  mutate(porcentaje = freq / sum(freq) * 100) %>%
  invisible()

suppressMessages({
  ggplot(porcentajes, aes(x = Propietaris, y = freq, fill = Genere_empresa)) +
    geom_bar(stat = "identity", position = "stack") +
    geom_text(aes(label = paste0(round(porcentaje, 1), "%"), 
                  y = freq, 
                  group = Genere_empresa), 
              position = position_stack(vjust = 0.5),
              size = 3, 
              color = "black") +
    scale_y_continuous(labels = scales::comma) +
    labs(title = "Distribución de género según número de dueño",
         x = "Número de dueño",
         y = "Porcentaje") +
    scale_fill_manual(values = c("F" = "#B4DCE7", "M" = "#F8D3A5", "Mixt" = "#D3D3D3")) +
    theme_minimal()
})
```

-   Nombre d'assalariats segons el nombre de sucursals

```{r, fig.width=3, fig.height=3}
porcentajes <- bbdd %>%
  filter(N_assalariats %in% c("0", "1", "2", "3", "4")) %>%
  count(N_assalariats, N_sucursals, name = "freq") %>%
  group_by(N_assalariats) %>%
  mutate(porcentaje = freq / sum(freq) * 100) %>%
  group_by(N_sucursals) %>%
  mutate(porcentaje = porcentaje / sum(porcentaje) * 100) %>%
  ungroup()


suppressMessages({
  ggplot(porcentajes, aes(x = N_sucursals, y = freq, fill = N_assalariats)) +
    geom_bar(stat = "identity", position = "stack") +
    geom_text(aes(label = paste0(round(porcentaje, 1), "%"), 
                  y = freq, 
                  group = N_assalariats), 
              position = position_stack(vjust = 0.5),
              size = 3, 
              color = "black") +
    scale_y_continuous(labels = scales::comma) +
    labs(title = "Distribución de cantidad de personal según número de sucursal",
         x = "Número de sucursal",
         y = "Porcentaje") +
    scale_fill_manual(values = c("1" = "#EED2EE", "2" = "#DDA0DD", "3" = "#BA55D3", "4" = "#8A2BE2" )) +
    theme_minimal()
})
```

-   Importacio vs Nombre sucursal

```{r}
# importacio exportacio vs n. sucursals

dades_importacio <- aggregate(cbind(Importacio_Nacional, Importacio_Europa, Importacio_intercontinental, Importacio_No) ~ N_sucursals, 
                             data = bbdd, FUN = sum)
# Convertir los datos de ancho a largo para poder graficarlos con ggplot

dades_importacio_llarg <- reshape2::melt(dades_importacio, id.vars = "N_sucursals",
                                       variable.name = "importacion", value.name = "n_importaciones")
#calcular percentatges
dades_importacio_llarg$Total_importacions <-  ave(dades_importacio_llarg$n_importaciones, dades_importacio_llarg$N_sucursals, FUN=sum)
dades_importacio_llarg$porcentaje <- round(dades_importacio_llarg$n_importaciones / dades_importacio_llarg$Total_importacions * 100,2)
# eix X N sucursal
ggplot(dades_importacio_llarg, aes(x = N_sucursals, y = n_importaciones, fill = importacion)) +
  geom_bar(stat = "identity") +
  labs(x = "Sucursal", y = "Número de importaciones") +
  scale_fill_manual(values = c("#619CFF", "#FFD447", "#FF6363", "#58CCB3"),
                    name = "Tipo de importación",
                    labels = c("Nacional", "Europa", "Intercontinental", "No")) + theme_classic()  +geom_text(aes(label = porcentaje), position = position_stack(vjust = 0.5), size=1.5) 

#######################################
# eix X variables importacio
dades_sucursal <- aggregate(cbind(Importacio_Nacional, Importacio_Europa, Importacio_intercontinental, Importacio_No) ~ N_sucursals, data = bbdd, FUN = sum)

dades_sucursal_llarg <- tidyr::pivot_longer(dades_sucursal, cols = c("Importacio_Nacional", "Importacio_Europa", "Importacio_intercontinental", "Importacio_No"), names_to = "Variable", values_to = "1s")
dades_sucursal_llarg$Variable <- as.factor(dades_sucursal_llarg$Variable)
# percentatge

porcentajes <- dades_sucursal_llarg %>%
     group_by(Variable) %>%
     mutate(porcentaje = (`1s` / sum(`1s`)) * 100) %>%
     ungroup()


# Crear un gráfico de barras con ggplot
ggplot(porcentajes, aes(x = Variable, y = `1s`, fill = factor(N_sucursals))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_x_discrete(labels = c("Europa", "Intercontinental", "Nacional", "No")) +
  labs(x = "Tipo de importación", y = "Número de importaciones", fill = "Nombre de sucursales") +
  ggtitle("Nombre sucursales per tipus d'importació") +
 geom_text(aes(label = paste0(round(porcentaje, 2), "%")), size = 3, position = position_stack(vjust = 0.5))

```

-   Exportació vs Nombre sucursal

```{r}
# importacio exportacio vs n. sucursals

dades_exportacio <- aggregate(cbind(Exportacio_Nacional, Exportacio_Europa, Exportacio_intercontinental, Exportacio_No) ~ N_sucursals, 
                             data = bbdd, FUN = sum)
# Convertir los datos de ancho a largo para poder graficarlos con ggplot

dades_exportacio_llarg <- reshape2::melt(dades_exportacio, id.vars = "N_sucursals",
                                       variable.name = "exportacion", value.name = "n_exportaciones")

porcentajes <- dades_exportacio_llarg %>%
     group_by(N_sucursals) %>%
     mutate(porcentaje = (n_exportaciones / sum(n_exportaciones)) * 100) %>%
     ungroup()


# eix X N sucursal
ggplot(porcentajes, aes(x = N_sucursals, y = n_exportaciones, fill = exportacion)) +
  geom_bar(stat = "identity") +
  labs(x = "Sucursal", y = "Número de exportaciones") +
  scale_fill_manual(values = c("#619CFF", "#FFD447", "#FF6363", "#58CCB3"),
                    name = "Tipo de exportación",
                    labels = c("Nacional", "Europa", "Intercontinental", "No")) + theme_classic()  +geom_text(aes(label = paste0(round(porcentaje, 2), "%")), size = 3, position = position_stack(vjust = 0.5))

#######################################
# eix X variables importacio
dades_sucursal <- aggregate(cbind(Exportacio_Nacional, Exportacio_Europa, Exportacio_intercontinental, Exportacio_No) ~ N_sucursals, data = bbdd, FUN = sum)

dades_sucursal_llarg <- tidyr::pivot_longer(dades_sucursal, cols = c("Exportacio_Nacional", "Exportacio_Europa", "Exportacio_intercontinental", "Exportacio_No"), names_to = "Variable", values_to = "1s")

porcentajes <- dades_sucursal_llarg %>%
     group_by(N_sucursals) %>%
     mutate(porcentaje = (`1s` / sum(`1s`)) * 100) %>%
     ungroup()

# Crear un gráfico de barras con ggplot
ggplot(porcentajes, aes(x = Variable, y = `1s`, fill = factor(N_sucursals))) +
  geom_bar(stat = "identity", position = "stack") +
  scale_x_discrete(labels = c("Europa", "Intercontinental", "Nacional", "No")) +
  labs(x = "Tipo de exportación", y = "Número de exportaciones", fill = "Nombre de sucursales") +
  ggtitle("Nombre sucursales per tipus d'exportació") +
  geom_text(aes(label = paste0(round(porcentaje, 2), "%")), size = 3, position = position_stack(vjust = 0.5))

```

```{r}

x <- which(bbdd$Propietaris=="1prop")
y <- which(bbdd$Propietaris=="+1prop")
bdfprop <- filter(bbdd, Propietaris %in% c("1prop","+1prop"))
bdfprop <- bbdd[bbdd$Propietaris==c("1prop","+1prop"),]


porcentajes <- bdfprop %>%
  filter(Genere_resposta %in% c("F", "M")) %>%
  group_by(Genere_resposta, Genere_empresa) %>%
  summarise(freq = sum(!is.na(Genere_empresa))) %>%
  group_by(Genere_resposta) %>%
  mutate(porcentaje = freq / sum(freq) * 100) %>%
  invisible()

suppressMessages({
  ggplot(porcentajes, aes(x = Genere_resposta, y = freq, fill = Genere_empresa)) +
    geom_bar(stat = "identity", position = "stack") +
    geom_text(aes(label = paste0(round(porcentaje, 1), "%"), 
              y = freq, 
              group = Genere_empresa), 
          position = position_stack(vjust = 0.5),
          size = 3, 
          color = "black") +
    scale_y_continuous(labels = scales::comma) +
    labs(title = "Distribución genero y género empresa",
         x = "Género",
         y = "Porcentaje") +
    scale_fill_manual(values = c("F" = "#808080", "M" = "#87CEFA", "Mixt" = "blue")) +
    theme_minimal()+
  theme(plot.title = element_text(size=10), 
        axis.text.x = element_text(size = 8, hjust = 1))
})

table(bdfprop$Genere_resposta, bdfprop$Genere_empresa)
```

# ANÀLISIS

```{r}
library(nnet)

# Hores benestar vs nombre assalariats
bbdd$Hores_benestar <- as.factor(bbdd$Hores_benestar)
m <- glm(Hores_benestar ~ N_assalariats, family = binomial,data=bbdd)
summary(m) #p-valor = 0.908
#
```

```{r}
# Edat vs Nombre assalariats
n <- lm(Edat ~ N_assalariats, data=bbdd)
summary(n)#p-valor = 0.11
```

Districte vs. Importacio/Exportacio

```{r}
# 
modelo <- glm(Districte ~ Exportacio_Nacional + Exportacio_Europa + Exportacio_intercontinental + Exportacio_No + Importacio_Nacional + Importacio_Europa + Importacio_intercontinental, data = bbdd, family = "binomial")

modelo <- multinom(Districte ~ Exportacio_Nacional + Exportacio_Europa + Exportacio_intercontinental + Exportacio_No + Importacio_Nacional + Importacio_Europa + Importacio_intercontinental, data = bbdd)
# no puc veure p-valor

```

Edat acces propietari/directiu vs Nº assalariats + Nº sucursals

```{r}
dones_resposta <- bbdd %>% filter(Genere_resposta=="F")
homes_resposta <- bbdd %>% filter(Genere_resposta=="M")

mod <- lm(Edat_acces ~ N_sucursals + N_assalariats, data=bbdd)
summary(mod)

mod_dones <- lm(Edat_acces ~ N_sucursals + N_assalariats, data=dones_resposta)
summary(mod_dones)

mod_homes <- lm(Edat ~ N_sucursals + N_assalariats, data=homes_resposta)
summary(mod_homes)
```

Edat vs nº fills + hores benestar

```{r}
bbdd$Fills <- as.numeric(bbdd$Fills)
dones_resposta$Fills <- as.numeric(dones_resposta$Fills)
homes_resposta$Fills <- as.numeric(homes_resposta$Fills)

mod_edat <- lm(Edat ~ Fills + Hores_benestar, data=bbdd)
summary(mod_edat)

mod_edat_dones <- lm(Edat ~ Fills + Hores_benestar, data=dones_resposta)
summary(mod_edat_dones)

mod_edat_homes <- lm(Edat ~Fills + Hores_benestar, data=homes_resposta)
summary(mod_edat_homes)
```

Antiguitat empresa vs Sectir i N. assalariats
```{r}
dones_empresa <- bbdd %>% filter(Genere_empresa=="F")
homes_empresa <- bbdd %>% filter(Genere_empresa=="M")
mixt_empresa <- bbdd %>% filter(Genere_empresa == "Mixt")
mod_anys_empresa <- lm(Anys_empresa ~ Sector + N_assalariats, data=bbdd)
summary(mod_anys_empresa)
mod_anys_empresa <- lm(Anys_empresa ~ Sector, data=bbdd)
summary(mod_anys_empresa)

mod_anys_empresa_dones <- lm(Anys_empresa ~ Sector + N_assalariats, data=dones_empresa)
summary(mod_anys_empresa_dones)

mod_anys_empresa_homes <- lm(Anys_empresa ~ Sector + N_assalariats, data=homes_empresa)
summary(mod_anys_empresa_homes)

mod_anys_empresa_mixt <- lm(Anys_empresa ~ Sector + N_assalariats, data=mixt_empresa)
summary(mod_anys_empresa_mixt)
```

Manera acces vs Districte (varies categories)
```{r, eval=FALSE}

mod_anys_empresa <- lm(Anys_empresa ~ Sector + N_assalariats, data=bbdd)
summary(mod_anys_empresa)
mod_anys_empresa <- lm(Anys_empresa ~ Sector, data=bbdd)
summary(mod_anys_empresa)

mod_anys_empresa_dones <- lm(Anys_empresa ~ Sector + N_assalariats, data=dones_empresa)
summary(mod_anys_empresa_dones)

mod_anys_empresa_homes <- lm(Anys_empresa ~ Sector + N_assalariats, data=homes_empresa)
summary(mod_anys_empresa_homes)

mod_anys_empresa_mixt <- lm(Anys_empresa ~ Sector + N_assalariats, data=mixt_empresa)
summary(mod_anys_empresa_mixt)
```


Importacio / Exportacio vs N_sucursal+N_personal+Sucursal_fora_principal

```{r}
mod_importacio <- glm(Importacio_No ~ N_sucursals + N_assalariats + Sucursal_fora_principal, data = bbdd, family=binomial)
summary(mod_importacio)

mod_importacio_dones <- glm(Importacio_No ~ N_sucursals + N_assalariats + Sucursal_fora_principal, data = dones_empresa, family=binomial)
summary(mod_importacio_dones)

mod_importacio_homes <- glm(Importacio_No ~ N_sucursals + N_assalariats + Sucursal_fora_principal, data = mixt_empresa, family=binomial)
summary(mod_importacio_homes)

mod_importacio_mixt <- glm(Importacio_No ~ N_sucursals + N_assalariats + Sucursal_fora_principal, data = mixt_empresa, family=binomial)
summary(mod_importacio_mixt)
```

